<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.easyexam.apps.dao.ExaminationRoomDao">
    <resultMap id="ExaminationRoomMap" type="com.easyexam.apps.entity.ExaminationRoom">
        <id property="id" column="id"></id>
        <result property="roomName" column="room_name"></result>
        <result property="joinPeopleNum" column="join_people_num"></result>
        <result property="totalPeopleNum" column="total_people_num"></result>
        <result property="address" column="address"></result>
        <result property="subjectId" column="subject_id"></result>
        <result property="invigilateId" column="invigilate_id"></result>
        <result property="beginTime" column="begin_time"></result>
        <result property="endTime" column="end_time"></result>
        <result property="paperId" column="paper_id"></result>
        <association property="subject" javaType="com.easyexam.apps.entity.Subject">
            <id property="id" column="id"></id>
            <result property="name" column="name"></result>
        </association>

        <collection property="paper" javaType="com.easyexam.apps.entity.Paper">
            <id property="id" column="id"></id>
            <result property="name" column="name"></result>
            <result property="creatTime" column="creat_time"></result>
            <result property="subjectId" column="subject_id"></result>
            <result property="checkId" column="check_id"></result>
            <result property="makeId" column="make_id"></result>

        </collection>


        <collection property="invigilate" javaType="com.easyexam.apps.entity.User">
            <id property="uid" column="uid"></id>
            <result property="name" column="name"></result>
            <result property="password" column="password"></result>
            <!--                <result property="age" column="age"></result>-->
            <!--                <result property="sex" column="sex"></result>-->
            <!--                <result property="position" column="position"></result>-->
            <!--                <result property="remark" column="remark"></result>-->
        </collection>


    </resultMap>
    <!--考场-->
    <select id="findAllExaminationRoom" resultMap="ExaminationRoomMap" parameterType="map">
    SELECT * from examination_room  e
    INNER JOIN subject s on e.subject_id=s.id
    INNER JOIN  p_user u on e.invigilate_id=u.uid
    INNER JOIN paper p on e.paper_id=p.id
    <where>
        1=1
        <if test="e.subject_id !=null">
            and e.subject_id=#{subjectId}
        </if>
       <if test="e.invigilate_id !=null">
           and e.invigilate_id=#{invigilateId}
       </if>
       <if test="e.paper_id !=null">
           and= e.paper_id=#{paperId}
       </if>
        <if test="info != null">
            and e.room_name like CONCAT('%','${info}','%')
        </if>
    </where>
    </select>

    <select id="findOneExaminationRoom" resultMap="ExaminationRoomMap">
    SELECT e.id ,e.room_name ,e.join_people_num ,e.total_people_num,e.address,
    s.name,u.name,e.begin_time,e.end_time,p.name
    from examination_room  e
    inner JOIN subject s on e.subject_id=s.id
    inner JOIN  p_user u on e.invigilate_id=u.uid
    inner JOIN paper p on e.paper_id=p.id
    where  e.id=#{id}
    </select>

    <update id="updateExaminationRoom" parameterType="ExaminationRoom">
    update examination_room
    set room_name=#{roomName},join_people_num=#{joinPeopleNum},
    total_people_num=#{totalPeopleNum},address=#{address},
    subject_id=#{subjectId},invigilate_id=#{invigilateId},
    begin_time=#{beginTime},end_time=#{endTime},
    paper_id=#{paperId}
    where id=#{id}
    </update>

    <delete id="deleteExaminationRoom" parameterType="int">
        delete from  examination_room where id=#{id}
    </delete>


</mapper>